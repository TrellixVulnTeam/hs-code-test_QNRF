import _defineProperty from"@babel/runtime/helpers/defineProperty";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _toConsumableArray from"@babel/runtime/helpers/toConsumableArray";import _asyncToGenerator from"@babel/runtime/helpers/asyncToGenerator";function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}import _regeneratorRuntime from"@babel/runtime/regenerator";import ReactDOM from"react-dom";import React,{createContext,useEffect,useState,useContext,useRef}from"react";import"../styles/index.scss";var IMAGE_NOT_FOUND_PLACEHOLDER="https://res.cloudinary.com/drxavrtbi/image/upload/v1633025966/projects/not-found-image-15383864787lu_bietqg.jpg",DATA_ENDPOINT="https://raw.githubusercontent.com/HubSpotWebTeam/CodeExercise/main/src/js/data/data.json",GET_GENRE_OPTIONS=["action","adventure","animation","biography","classic","comedy","crime"],YEAR_FILTER_OPTIONS=["1870","1892","1895","1963","1971","1973","1974"],usePrevious=function(e){var t=useRef();return useEffect((function(){t.current=e})),t.current},clientRequestData=function(){var e=_asyncToGenerator(_regeneratorRuntime.mark((function e(){return _regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(DATA_ENDPOINT).then((function(e){if(e.ok)return e.json()})).catch((function(e){return e.message}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getNewData=function(e,t){var r=t.genre.length>0,n=t.year.length>0,a=""!==t.type,c=[];return r&&(c=[].concat(_toConsumableArray(c),_toConsumableArray(e.filter((function(e){return e.genre.some((function(r){return t.genre.includes(r)&&-1===c.indexOf(e)}))}))))),n&&(c=[].concat(_toConsumableArray(c),_toConsumableArray(e.filter((function(e){return t.year.includes(e.year)&&-1===c.indexOf(e)}))))),a&&(0===c.length&&(c=e),c=_toConsumableArray(c.filter((function(e){return e.type===t.type})))),console.log(c),c},sortData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.sort((function(e,t){return null==e?void 0:e.title.localeCompare(null==t?void 0:t.title)}))},ExerciseTwoContext=createContext(null),useExerciseContext=function(){return useContext(ExerciseTwoContext)},FILTERS_INITIAL_STATE={genre:[],year:[],type:"",searchQuery:""},ExerciseTwoContextProvider=function(e){var t=e.children,r=useState([]),n=_slicedToArray(r,2),a=n[0],c=n[1],o=useState([]),i=_slicedToArray(o,2),l=i[0],s=i[1],u=useState(FILTERS_INITIAL_STATE),m=_slicedToArray(u,2),d=m[0],f=m[1],p=usePrevious(d),E=d.genre.length>0||d.year.length>0||""!==d.type?Object.keys(p).find((function(e){return p[e]!==d[e]})):void 0;return useEffect((function(){var e=function(){var e=_asyncToGenerator(_regeneratorRuntime.mark((function e(){var t;return _regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,clientRequestData();case 2:t=e.sent,c(sortData(t.media)),s(sortData(t.media));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]),useEffect((function(){E&&s(getNewData(a,d))}),[d,a,E]),React.createElement(ExerciseTwoContext.Provider,{value:{data:l,filters:d,handleClearFilters:function(){f(FILTERS_INITIAL_STATE),s(a)},handleSelectedFilterOption:function(e){var t=e.target.id.split("|"),r=_slicedToArray(t,3),n=r[0],a=r[1],c=r[2];f((function(e){return _objectSpread(_objectSpread({},e),{},_defineProperty({},n,e[n].includes(a)?e[n].slice(c,1):[].concat(_toConsumableArray(e[n]),[a])))}))},toggleActiveMediaType:function(e){f((function(t){return _objectSpread(_objectSpread({},t),{},{type:e.target.id})}))},filterByQuery:function(e){var t=a.filter((function(t){return-1!==t.title.toLowerCase().indexOf(e)}));return s(t)}}},t)},RadioButton=function(e){var t=e.name,r=e.handleChange,n=e.label,a=e.checked;return React.createElement("div",{className:"ui-radio-btn"},React.createElement("input",{name:t,type:"radio",onChange:r,checked:a,id:t}),React.createElement("label",{htmlFor:t},n))},Image=function(e){var t=e.item,r=useState(!0),n=_slicedToArray(r,2),a=n[0],c=n[1],o=useState(!1),i=_slicedToArray(o,2),l=i[0],s=i[1];return React.createElement("div",{className:"img-container"},React.createElement("div",{className:"img-wrapper"},a&&React.createElement("div",{className:"image-skeleton loading"}),l?React.createElement("img",{src:IMAGE_NOT_FOUND_PLACEHOLDER}):React.createElement("img",{onError:function(){s(!0),c(!1)},onLoad:function(){return c(!1)},src:t.poster,alt:t.title})),React.createElement("div",{className:"img-detail"},React.createElement("span",null,"".concat(t.title," (").concat(t.year,")")),React.createElement("div",null,React.createElement("span",null,"Genres"),t.genre.map((function(e,t){return React.createElement("span",{key:t},", ",e)})))))},SelectFilter=function(e){var t=e.options,r=void 0===t?[]:t,n=e.selectedOptions,a=void 0===n?[]:n,c=e.name,o=e.onChange,i=useState(!1),l=_slicedToArray(i,2),s=l[0],u=l[1],m=useRef(),d=function(){u((function(e){return!e}))};return React.createElement("div",{className:"ui-select ".concat(c)},React.createElement("select",{onMouseDown:d,defaultValue:c},React.createElement("option",{className:"hide-option",disabled:!0,defaultValue:c},c)),s&&React.createElement("div",{ref:m,className:"checkbox-list",onMouseLeave:d},r.map((function(e,t){var r=a.includes(e);return React.createElement("label",{htmlFor:"label-".concat(t)},React.createElement("input",{name:"label-".concat(t),type:"checkbox",checked:r,value:e,id:"".concat(c,"|").concat(e,"|").concat(t),onChange:o}),e)}))))},FilterOptions=function(){var e=useExerciseContext(),t=e.filters,r=e.handleSelectedFilterOption,n=e.filterByQuery;return React.createElement("div",{className:"media-block-filter-options"},React.createElement("div",{className:"media-block-select-options"},React.createElement(SelectFilter,{name:"genre",options:GET_GENRE_OPTIONS,selectedOptions:null==t?void 0:t.genre,onChange:r}),React.createElement(SelectFilter,{name:"year",options:YEAR_FILTER_OPTIONS,selectedOptions:null==t?void 0:t.year,onChange:r})),React.createElement("div",{className:"media-block-search search-input-container"},React.createElement("input",{placeholder:"Search",className:"ui-input",onChange:function(e){var t=e.target.value;n(t)}})))},ExerciseTwo=function(){var e=useExerciseContext(),t=e.data,r=e.filters,n=e.toggleActiveMediaType,a=e.handleClearFilters;return React.createElement("div",{className:"media-block"},React.createElement("div",{className:"media-block-wrapper"},React.createElement("div",{className:"media-block-header"},React.createElement(FilterOptions,null),React.createElement("div",{className:"media-block-filter-options"},React.createElement("div",{className:"media-block-radio-options"},React.createElement(RadioButton,{name:"movie",label:"Movies",handleChange:n,checked:"movie"===r.type}),React.createElement(RadioButton,{name:"book",label:"Books",handleChange:n,checked:"book"===r.type})),React.createElement("div",{className:"media-block-clear-filters"},React.createElement("button",{className:"ui-link-btn",onClick:a},"Clear Filters")))),React.createElement("div",{className:"media-block-content"},t.map((function(e,t){return React.createElement(Image,{key:t,item:e})})))))},ExerciseTwoComponent=function(){return React.createElement(ExerciseTwoContextProvider,null,React.createElement(ExerciseTwo,null))},ROOT_ELEMENT=document.getElementById("exercise-two-root");ReactDOM.render(React.createElement(ExerciseTwoComponent,null),ROOT_ELEMENT);